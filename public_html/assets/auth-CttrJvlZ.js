import{m as f}from"./module.esm-uXcmRlT3.js";import{A as u,I as d,a as m}from"./ip-K9DB_9g-.js";import{h as p}from"./redirect-DipYIrIg.js";import{a as g,t as w}from"./toast-C5YoKCAA.js";let l=new u;l.base="/api/auth";class o extends Error{}o.prototype.name="InvalidTokenError";function y(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,a)=>{let i=a.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function I(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return y(e)}catch{return atob(e)}}function k(s,e){if(typeof s!="string")throw new o("Invalid token specified: must be a string");e||(e={});const a=e.header===!0?0:1,i=s.split(".")[a];if(typeof i!="string")throw new o(`Invalid token specified: missing part #${a+1}`);let t;try{t=I(i)}catch(r){throw new o(`Invalid token specified: invalid base64 for part #${a+1} (${r.message})`)}try{return JSON.parse(t)}catch(r){throw new o(`Invalid token specified: invalid json for part #${a+1} (${r.message})`)}}function b(){f.data("auth",(s="/app")=>({isProcessing:!1,success:!1,init(){p.saveRedirectPath()},async submit(){if(this.isProcessing)return;this.isProcessing=!0;let e=new FormData(this.$refs.form);this.$refs.form.querySelectorAll('input[type="checkbox"]').forEach(t=>{e.append(t.name,t.checked?"1":"0")}),e.append("locale",document.documentElement.lang);try{const t=await d.getIpInfo();e.append("ip",t.ipAddress),e.append("country_code",t.countryCode),e.append("city_name",t.cityName)}catch{}const a={};e.forEach((t,r)=>a[r]=t);let i=g("ref");i&&(a.ref=i,document.cookie="ref=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"),l.post(this.$refs.form.dataset.apiPath,a).then(t=>{if(t.data.jwt){const r=t.data.jwt,h=k(r);localStorage.setItem("jwt",r);let n=h.is_admin?"/admin":s,c=p.getRedirectPath();c&&(n=c),window.location.href=n}else this.isProcessing=!0,this.success=!0}).catch(t=>{if(t instanceof m){let r=null;t.response.status==401&&(r="Invalid credentials. Please try again."),t.response.status==409&&t.response.data.param=="email"&&(r="The email you entered is already taken."),r&&w.error(r)}window.captcha&&window.captcha.reset(),this.isProcessing=!1})},async ipinfo(){try{let e=await d.getIpInfo(),a={ip:e.ipAddress,country_code:e.countryCode,city_name:e.cityName};document.cookie=`ipinfo=${JSON.stringify(a)};path=/`}catch{}}}))}b();f.start();
